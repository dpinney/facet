<!doctype html>
<html>

<head>
  <title>View and export Hypothesis annotations</title>
  <link rel="stylesheet" href="https://jonudell.info/hlib/hlib.css">
  <script src="https://jonudell.info/hlib/hlib2.bundle.js" charset="utf-8"></script>
  <style>
    body {
      margin-top: 20px;
    }
    button {
      margin: 0;
      border-width: thin;
      background-color: #f3f1ee;
    }
    #container {
      display: flex;
      flex-direction: row;
      width: 100%;
    }
    .formContainer {
      margin-top: 12px;
    }
    #leftbarContainer {
      width: 30%;
      display: flex;
      flex-direction: column;
    }
    #iframeContainer {
      width: 100%;
    }
    
    #iframe {
      width: 100%;
      height: 100%;
      border-style: none;
      margin-left: -20px;
    }
    .help {
      font-size: smaller;
      margin-top:12px;
    }

    .facets, .settings {
      border-style: solid;
      border-width: thin;
      padding-left: 1em;
      border-color: lightgray;
      margin-bottom: 20px;
    }

    .formField {
      margin-bottom: 8px;
    }

    #buttonsContainer {
      display: flex;
      flex-direction: row;
      justify-content: flex-end;
    }

    .formLabel {
      font-size: smaller;
      color: #722704;
    }

    .formMessage {
      font-size: smaller;
      font-weight: normal;
    }

    .icon-pencil, .icon-floppy {
      font-size: x-small;
      width: 1em;
      height: 1em;
    }

    .subjectUserTokensForm, .controlledTagsForm {
      font-size: smaller;
    }

    svg {
      fill:#582108b5;
    }

  </style>
</head>

<body>

  <svg style="position: absolute; width: 0; height: 0; overflow: hidden" version="1.1" xmlns="http://www.w3.org/2000/svg"
  xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs>
    <symbol id="icon-floppy" viewBox="0 0 32 32">
        <title>save</title>
        <path d="M30 32h-28c-1.104 0-2-0.896-2-2v-28c0-1.104 0.896-2 2-2h24l6 6v24c0 1.104-0.896 2-2 2zM8 27c0 0.553 0.448 1 1 1h14c0.553 0 1-0.447 1-1v-8c0-0.553-0.447-1-1-1h-14c-0.552 0-1 0.447-1 1v8zM22 5c0-0.553-0.447-1-1-1s-1 0.447-1 1v3c0 0.553 0.447 1 1 1s1-0.447 1-1v-3zM28 7l-3-3h-1v7c0 0.553-0.447 1-1 1h-14c-0.552 0-1-0.447-1-1v-7h-3c-0.552 0-1 0.447-1 1v22c0 0.553 0.448 1 1 1h1v-11c0-0.553 0.448-1 1-1h18c0.553 0 1 0.447 1 1v11h1c0.553 0 1-0.447 1-1v-20z"></path>
      </symbol>    
    <symbol id="icon-pencil" viewBox="0 0 32 32">
        <title>edit</title>
      <path d="M30.173 7.542l-0.314 0.314-5.726-5.729 0.313-0.313c0 0 1.371-1.813 3.321-1.813 0.859 0 1.832 0.353 2.849 1.37 3.354 3.354-0.443 6.171-0.443 6.171zM27.979 9.737l-19.499 19.506-8.48 2.757 2.756-8.485v-0.003h0.002l19.496-19.505 0.252 0.253zM2.76 29.239l4.237-1.219-2.894-3.082-1.343 4.301z"></path>
    </symbol>
    </defs>
</svg>  

  <div id="container">

    <div id="leftbarContainer">

      <div id="buttonsContainer">
        <div>
          <button id="buttonHTML" title="view or download search results as HTML" onclick="getHTML()">HTML</button>
        </div>  
         <div>
          <button title="view or download search results as CSV" onclick="getCSV()">CSV</button>
         </div>
         <div>
          <button title="view or download search results as JSON" onclick="getJSON()">JSON</button>
        </div>
      </div>

      <div class="formContainer">
            <div class="facets">
            <div class="formField" id="userContainer"></div>
            <div class="formField" id="groupContainer"></div>
            <div class="formField" id="urlContainer"></div>
            <div class="formField" id="wildcard_uriContainer"></div>
            <div class="formField" id="tagContainer"></div>
            <div class="formField" id="anyContainer"></div>
          </div>
          <div class="settings">
            <div class="formField" id="maxContainer"></div>
            <div class="formField" id="expandedContainer"></div>
            <div class="formField" id="searchRepliesContainer"></div>
            <div class="formField" id="exactTagSearchContainer"></div>
            <div class="formField" id="tokenContainer"></div>
            <div class="formField" id="subjectsContainer"></div>
            <div class="formField" id="controlledTagsContainer"></div>
          </div>
      
      </div>

    </div>
    
    <div id="iframeContainer">
      <iframe id="iframe" src=""></iframe>
    </div>

  </div>

  <p class="help">
      Click HTML, CSV, or JSON to search for matching Hypothesis annotations and display them
      in one of those formats. Fill in one or more <i>facets</i> to filter results. The facets are
      <b>username</b>, <b>group</b>, <b>url</b> (or <b>wildcard_uri</b>), <b>tag</b>, and <b>any</b>. If you need more
      than 100 results, set <b>max</b> to a larger number. If you specify no facets other than the
      default group All, you'll get the most recent 100 Hypothesis annotations in any group you're authorized to see. 
      Results by default are grouped by URL, ordered by recency, and displayed as threads. But the default view 
      won't find things that exist only in replies. For that, tick <i>search replies</i> to get all matching
      annotations and replies, again grouped by URL and ordered by recency, but not displayed as threads.
      To match a tag exactly (and case-sensitively), tick <i>exact tag search</i>. Use <i>subject user tokens</i> 
      to enable in-place editing of annotations by users who have shared their tokens with you. Questions to judell 
      at hypothe dot is.
    </p>
  

  <script src="./index.js"></script>

  <script>
    setTimeout(_ => {
      let token = hlib.getToken()
      if (token) {
        hlib.getById('tokenContainer').style.display = 'none'
        hlib.getById('buttonHTML').click()
      }
    }, 500)
  </script>

</body>

</html>